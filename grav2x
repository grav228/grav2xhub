local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/x2zu/OPEN-SOURCE-UI-ROBLOX/refs/heads/main/X2ZU%20UI%20ROBLOX%20OPEN%20SOURCE/DummyUi-leak-by-x2zu/fetching-main/Tools/Framework.luau"))()

-- Create Main Window
local Window = Library:Window({
    Title = "Grav2x hub",
    Desc = "Grav's Hub 2.0",
    Icon = 105059922903197,
    Theme = "Dark",
    Config = {
        Keybind = Enum.KeyCode.LeftControl,
        Size = UDim2.new(0, 500, 0, 400)
    },
    CloseUIButton = {
        Enabled = true,
        Text = "grav2x"
    }
})

-- Sidebar Vertical Separator
local SidebarLine = Instance.new("Frame")
SidebarLine.Size = UDim2.new(0, 1, 1, 0)
SidebarLine.Position = UDim2.new(0, 140, 0, 0)
SidebarLine.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
SidebarLine.BorderSizePixel = 0
SidebarLine.ZIndex = 5
SidebarLine.Name = "SidebarLine"
SidebarLine.Parent = game:GetService("CoreGui")

-- –¢–∞–± Main
local Tab = Window:Tab({Title = "Main", Icon = "star"})

-- ESP –∫–æ–¥ (–ò–°–ü–†–ê–í–õ–ï–ù respawn)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ESP_ENABLED = false
local espBoxes = {}
local espGuis = {}
local charConnections = {}  -- ‚úÖ –ì–õ–û–ë–ê–õ–¨–ù–´–ô –•–†–ê–ù respawn

local function cleanupPlayer(player)
    if espBoxes[player] then 
        pcall(function() espBoxes[player]:Destroy() end)
        espBoxes[player] = nil 
    end
    if espGuis[player] then 
        pcall(function() espGuis[player]:Destroy() end)
        espGuis[player] = nil 
    end
end

local function createESP(player)
    if player == LocalPlayer or not ESP_ENABLED then return end
    
    local function onCharacterAdded(character)
        if not ESP_ENABLED then return end  -- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        
        cleanupPlayer(player)  -- ‚úÖ –û—á–∏—Å—Ç–∫–∞
        
        -- ‚úÖ –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫—É
        local hrp = character:WaitForChild("HumanoidRootPart", 10)
        local head = character:WaitForChild("Head", 10)
        local humanoid = character:WaitForChild("Humanoid", 10)
        
        if not (hrp and head and humanoid) then 
            warn("ESP", player.Name)
            return 
        end
        
        print("ESP created for", player.Name)  -- ‚úÖ Debug
        
        -- Box
        local box = Instance.new("BoxHandleAdornment")
        box.Name = "ESP_Box_" .. player.Name
        box.Adornee = hrp
        local playerHeight = humanoid.HipHeight + head.Size.Y + 1
        box.Size = Vector3.new(4, playerHeight, 2)
        box.Color3 = Color3.fromRGB(255, 0, 0)
        box.Transparency = 0.5
        box.AlwaysOnTop = true
        box.ZIndex = 10
        box.Parent = hrp
        espBoxes[player] = box
        
        -- Billboard
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ESP_NameHealth_" .. player.Name
        billboard.Adornee = head
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.AlwaysOnTop = true
        billboard.Parent = head
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = player.Name
        nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        nameLabel.TextScaled = true
        nameLabel.Font = Enum.Font.SourceSansBold
        nameLabel.Parent = billboard
        
        local hpLabel = Instance.new("TextLabel")
        hpLabel.Size = UDim2.new(1, 0, 0.5, 0)
        hpLabel.Position = UDim2.new(0, 0, 0.5, 0)
        hpLabel.BackgroundTransparency = 1
        hpLabel.Text = "HP: " .. math.floor(humanoid.Health)
        hpLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        hpLabel.TextScaled = true
        hpLabel.Font = Enum.Font.SourceSans
        hpLabel.Parent = billboard
        espGuis[player] = billboard
        
        -- ‚úÖ Health conn
        local healthConn = humanoid.HealthChanged:Connect(function(health)
            if not ESP_ENABLED or not hpLabel.Parent then return end
            local percent = math.floor((health / humanoid.MaxHealth) * 100)
            hpLabel.Text = "HP: " .. math.floor(health) .. " (" .. percent .. "%)"
            hpLabel.TextColor3 = percent > 50 and Color3.fromRGB(0, 255, 0) or (percent > 25 and Color3.fromRGB(255, 255, 0) or Color3.fromRGB(255, 0, 0))
        end)
        
        -- ‚úÖ HipHeight conn
        local hipConn = humanoid:GetPropertyChangedSignal("HipHeight"):Connect(function()
            if not ESP_ENABLED or not box.Parent then return end
            local newHeight = humanoid.HipHeight + head.Size.Y + 1
            box.Size = Vector3.new(4, newHeight, 2)
        end)
    end
    
    -- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂
    if player.Character and player.Character.Parent then
        onCharacterAdded(player.Character)
    end
    
    -- ‚úÖ –ì–õ–û–ë–ê–õ–¨–ù–´–ô CharacterAdded (–ù–ï –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è)
    if not charConnections[player] then
        charConnections[player] = player.CharacterAdded:Connect(function()
            task.wait(0.5)  -- ‚úÖ –ñ–¥—ë–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            if ESP_ENABLED then
                onCharacterAdded(player.Character)
            end
        end)
    end
end

local function toggleESP(state)
    ESP_ENABLED = state
    print("üîÑ ESP toggle:", state) 
    
    if state then
        -- –í–∫–ª—é—á–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö
        for _, player in ipairs(Players:GetPlayers()) do
            createESP(player)
        end
        Window:Notify({
            Title = "ESP",
            Desc = "On (respawn fixed)",
            Time = 2
        })
    else
        -- –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
        for player, _ in pairs(espBoxes) do
            cleanupPlayer(player)
        end
        espBoxes = {}
        espGuis = {}
        Window:Notify({
            Title = "ESP",
            Desc = "Off",
            Time = 2
        })
    end
end

-- Toggle UI
Tab:Toggle({
    Title = "ESP (Box + HP + name)",
    Desc = "Red box ESP",
    Value = false,
    Callback = function(v)
        toggleESP(v)
    end
})

-- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
Players.PlayerRemoving:Connect(function(player)
    cleanupPlayer(player)
    charConnections[player] = nil
end)

-- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
for _, player in ipairs(Players:GetPlayers()) do
    createESP(player)
end

Window:Notify({
    Title = "grav2x",
    Desc = "ESP",
    Time = 3
})
